// --------------------------------------------------------------------------------------------------------------------
/// \file LibService.c
///
/// \brief Interface for a service (pseudo thread).
///
/// All Rights Reserved.
// --------------------------------------------------------------------------------------------------------------------



// --------------------------------------------------------------------------------------------------------------------
//	Local Definitions to control properties inside header files
// --------------------------------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------------------------------------------------
//	Includes
// --------------------------------------------------------------------------------------------------------------------
#include "LibService.h"
#include "LibTypes.h"
#include "LibServiceHost.h"

// --------------------------------------------------------------------------------------------------------------------
//	Local Definitions 
// --------------------------------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------------------------------------------------
//	Local Data Types
// --------------------------------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------------------------------------------------
//	Global Variables 
// --------------------------------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------------------------------------------------
//	Local Variables
// --------------------------------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------------------------------------------------
//	Local Function Prototypes
// --------------------------------------------------------------------------------------------------------------------


// --------------------------------------------------------------------------------------------------------------------
//	Functions
// --------------------------------------------------------------------------------------------------------------------


//=====================================================================================================================
// LibService_SetEvent:
//=====================================================================================================================

void LibService_SetEvent(S_LibService_Inst_t* const pService, const uint32_t eventMask)
{
	// set the event
	Lib_Assert(NULL != pService);
	SuspendAllInterrupts();
	pService->EventMask |= eventMask;
	ResumeAllInterrupts();
	
	// notify the service host about a new pending event from a hosted service
	if (NULL != pService->pServiceHost)
	{
		LibServiceHost_Notify(pService->pServiceHost);
	}
}


//=====================================================================================================================
// LibService_GetEvent:
//=====================================================================================================================
uint32_t LibService_GetEvent(const S_LibService_Inst_t* const pService)
{
	uint32_t retval;

	// get the event mask
	Lib_Assert(NULL != pService);
	SuspendAllInterrupts();
	retval = pService->EventMask;
	ResumeAllInterrupts();

	return retval;
}


//=====================================================================================================================
// LibService_ClearEvent:
//=====================================================================================================================
void LibService_ClearEvent(S_LibService_Inst_t* const pService, const uint32_t eventMask)
{
	// clear the event
	Lib_Assert(NULL != pService);
	SuspendAllInterrupts();
	pService->EventMask &= ~eventMask;
	ResumeAllInterrupts();
}


//=====================================================================================================================
// LibService_CheckClearEvent:
//=====================================================================================================================
bool_t LibService_CheckClearEvent(S_LibService_Inst_t* const pService, const uint32_t eventMask)
{
	bool_t retval;
	
	// check whether at least one of the events has been set and clear the event(s)
	Lib_Assert(NULL != pService);
	SuspendAllInterrupts();
	retval = (UINT32_C(0) != (pService->EventMask & eventMask));
	pService->EventMask &= ~eventMask;
	ResumeAllInterrupts();

	return retval;
}


//=====================================================================================================================
// LibService_Terminate:
//=====================================================================================================================
void LibService_Terminate(S_LibService_Inst_t* const pService)
{
	Lib_Assert((NULL != pService) && (!pService->Terminated));
	pService->Terminated = true;
}
